<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button [defaultHref]="['/auth', 'servers', serverId]"></ion-back-button>
    </ion-buttons>
    <ion-title>{{ app['title'] | async }}</ion-title>
    <ion-buttons slot="end" class="ion-padding-end">
      <ion-button (click)="presentAction()" color="primary">
        <ion-icon name="ellipsis-vertical-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>

  <ion-refresher slot="fixed" (ionRefresh)="doRefresh($event)">
    <ion-refresher-content pullingIcon="lines" refreshingSpinner="lines"></ion-refresher-content>
  </ion-refresher>

  <ion-item *ngIf="error" style="margin-bottom: 16px;">
    <ion-text class="ion-text-wrap" color="danger">{{ error }}</ion-text>
  </ion-item>

  <ion-spinner *ngIf="loading" class="center" name="lines" color="warning"></ion-spinner>

  <div *ngIf="!loading">

    <ion-item-group>
      <ion-item>
        <ion-label position="stacked">Status</ion-label>
        <h5>
          <s9-status [appStatus]="app['status'] | async"></s9-status>
        </h5>
      </ion-item>
    </ion-item-group>

    <ion-button *ngIf="['NEEDS_CONFIG', 'RECOVERABLE'].includes(app['status'] | async)" style="margin: 16px 0;"
      expand="block" fill="outline" color="warning" [routerLink]="['config']">
      Config
    </ion-button>

    <ion-button *ngIf="(app['status'] | async) === 'STOPPED'" style="margin: 16px 0;" expand="block" fill="outline"
      color="success" (click)="start()">
      Start
    </ion-button>

    <ion-button *ngIf="['RUNNING', 'RESTARTING'].includes(app['status'] | async)" style="margin: 16px 0;"
      expand="block" fill="outline" color="danger" (click)="stop()">
      Stop
    </ion-button>

    <ion-button *ngIf="(app['status'] | async) === 'DEAD'" style="margin: 16px 0;" expand="block" fill="outline"
      color="primary" (click)="presentAlertUninstall()">
      Force Uninstall
    </ion-button>

    <ion-item-group class="ion-text-wrap" *ngIf="(app['versionInstalled'] | async) && (app['status'] | async) !== 'INSTALLING'">
      <ion-item-divider></ion-item-divider>
      <ion-item>
        <ion-label position="stacked">App ID</ion-label>
        <ion-text color="medium">
          <h5>{{ app['id'] | async }}</h5>
        </ion-text>
      </ion-item>
      <ion-item>
        <ion-label position="stacked">Version</ion-label>
        <ion-text color="medium">
          <h5>{{ app['versionInstalled'] | async }}</h5>
        </ion-text>
      </ion-item>
      <ion-item *ngIf="app['torAddress'] | async">
        <ion-label position="stacked">Tor Address</ion-label>
        <ion-text style="word-break: break-all;" color="medium">
          <h5>{{ app['torAddress'] | async }}</h5>
        </ion-text>
        <ion-note slot="end">
          <ion-button (click)="copyTor()" fill="outline" size="small">
            Copy
          </ion-button>
        </ion-note>
      </ion-item>
    </ion-item-group>

  </div>

</ion-content>